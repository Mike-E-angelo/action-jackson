name: Release Build Trigger

on:
  release:
    types: [published]

jobs:
  build:

    runs-on: ubuntu-latest
    
    steps:
    - name: Dump GitHub context
      env:
        GITHUB_CONTEXT: ${{ toJson(github) }}
      run: echo "$GITHUB_CONTEXT"
    - name: Dump job context
      env:
        JOB_CONTEXT: ${{ toJson(job) }}
      run: echo "$JOB_CONTEXT"
    - name: Dump steps context
      env:
        STEPS_CONTEXT: ${{ toJson(steps) }}
      run: echo "$STEPS_CONTEXT"
    - name: Dump runner context
      env:
        RUNNER_CONTEXT: ${{ toJson(runner) }}
      run: echo "$RUNNER_CONTEXT"
    - name: Dump strategy context
      env:
        STRATEGY_CONTEXT: ${{ toJson(strategy) }}
      run: echo "$STRATEGY_CONTEXT"
    - name: Run a multi-line script
      run: |
           $headers = @{
             "Authorization" = "Bearer ${{ secrets.API_APPVEYOR_TOKEN }}"
             "Content-type" = "application/json"
           }

           $body = @{
               accountName="ExtendedXmlSerializer"
               projectSlug="action-jackson"
               branch="master"
               commitId="v2FRIST-1.0.1"
               # environmentVariables=@{
               #  APPVEYOR_REPO_COMMIT_AUTHOR="Mike-EEE's GitHub Action Automation Agent"
               #  APPVEYOR_REPO_COMMIT_AUTHOR_EMAIL="Mike-EEE@users.noreply.github.com"
               # }
           }
           $body = $body | ConvertTo-Json

           Invoke-RestMethod -Uri 'https://ci.appveyor.com/api/builds' -Headers $headers  -Body $body -Method POST
      shell: pwsh
